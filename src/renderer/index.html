<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self' ws: wss: stun: turn:">
  <title>✨ 同弈 | 天涯·归魂</title>
  <meta name="author" content="步紧 (Bujin)">
  <meta name="description" content="同弈 (SyncGo) - 三宝棋道工作室出品 | 天涯·归魂纪念版">
  <meta name="copyright" content="Copyright © 2026 三宝棋道工作室 (Sanbao Chess Studio)">
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/board.css">
  <link rel="stylesheet" href="styles/ui.css">
</head>
<body>
  <!-- 🏝️ 背景装饰 -->
  <div class="bg-decoration"></div>

  <!-- 🎵 背景音乐控制 -->
  <div class="bg-music-control" id="bg-music-control" title="背景音乐">
    <button id="btn-music-toggle" class="music-btn" title="播放/暂停">
      <span class="music-icon">🎵</span>
    </button>
    <div class="music-volume-container">
      <input type="range" id="music-volume" class="volume-slider" min="0" max="100" value="40" title="音量">
    </div>
  </div>
  
  <!-- Home Screen -->
  <div id="screen-home" class="screen active">
    <div class="home-container">
      <h1 class="game-title title-memorial">天涯·归魂</h1>
      <p class="game-subtitle">SyncGo · Tianya Returning Soul</p>
      <p class="game-version">✨ 天涯·归魂纪念版 2026春节 ✨</p>
      
      <div class="menu-buttons">
        <button id="btn-host" class="menu-btn primary btn-memorial">
          <span class="btn-icon">🏠</span>
          <span class="btn-text">创建房间</span>
          <span class="btn-desc">Host Game</span>
        </button>
        
        <button id="btn-join" class="menu-btn secondary btn-memorial-secondary">
          <span class="btn-icon">🔗</span>
          <span class="btn-text">加入房间</span>
          <span class="btn-desc">Join Game</span>
        </button>
        
        <button id="btn-ai" class="menu-btn accent btn-memorial-secondary">
          <span class="btn-icon">🤖</span>
          <span class="btn-text">人机对弈</span>
          <span class="btn-desc">vs AI</span>
        </button>
        
        <button id="btn-webrtc" class="menu-btn accent btn-memorial-secondary">
          <span class="btn-icon">🌐</span>
          <span class="btn-text">联机对战</span>
          <span class="btn-desc">无需服务器</span>
        </button>
      </div>
      
      <div class="home-footer">
        <p class="footer-copyright">© 2026 三宝棋道工作室 (Sanbao Chess Studio)</p>
        <p class="footer-author">作者: 步紧 (Bujin)</p>
      </div>
    </div>
  </div>

  <!-- Host Setup Screen -->
  <div id="screen-host" class="screen">
    <div class="setup-container glass-memorial">
      <h2>创建房间</h2>
      <div class="form-group">
        <label for="host-name">玩家名称</label>
        <input type="text" id="host-name" value="黑方" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="host-time">基本用时</label>
        <select id="host-time">
          <option value="600000">10 分钟</option>
          <option value="900000">15 分钟</option>
          <option value="1200000">20 分钟</option>
          <option value="1800000" selected>30 分钟</option>
          <option value="2700000">45 分钟</option>
          <option value="3600000">1 小时</option>
          <option value="5400000">1.5 小时</option>
          <option value="7200000">2 小时</option>
          <option value="10800000">3 小时</option>
          <option value="18000000">5 小时</option>
        </select>
      </div>
      <div class="form-group">
        <label for="host-port">端口</label>
        <input type="number" id="host-port" value="38765" min="1024" max="65535">
      </div>
      
      <div id="host-waiting" class="waiting-info" style="display:none;">
        <div class="spinner"></div>
        <p>等待对手加入...</p>
        <p class="ip-info" id="host-ip-info"></p>
      </div>
      
      <div class="form-actions">
        <button id="btn-host-back" class="btn-back">返回</button>
        <button id="btn-host-start" class="btn-start btn-memorial">开始等待</button>
      </div>
    </div>
  </div>

  <!-- Join Game Screen -->
  <div id="screen-join" class="screen">
    <div class="setup-container glass-memorial">
      <h2>加入房间</h2>
      <div class="form-group">
        <label for="join-name">玩家名称</label>
        <input type="text" id="join-name" value="白方" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="join-host">主机地址</label>
        <input type="text" id="join-host" placeholder="例如: 192.168.1.100">
      </div>
      <div class="form-group">
        <label for="join-port">端口</label>
        <input type="number" id="join-port" value="38765" min="1024" max="65535">
      </div>
      
      <div id="join-status" class="status-info" style="display:none;"></div>
      
      <div class="form-actions">
        <button id="btn-join-back" class="btn-back">返回</button>
        <button id="btn-join-connect" class="btn-start btn-memorial">连接</button>
      </div>
    </div>
  </div>

  <!-- AI Setup Screen -->
  <div id="screen-ai" class="screen">
    <div class="setup-container glass-memorial">
      <h2>人机对弈</h2>
      <div class="form-group">
        <label for="ai-name">玩家名称</label>
        <input type="text" id="ai-name" value="玩家" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="ai-color">选择颜色</label>
        <select id="ai-color">
          <option value="black">黑方 (先手)</option>
          <option value="white">白方</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ai-difficulty">AI 难度</label>
        <select id="ai-difficulty">
          <option value="easy">简单</option>
          <option value="medium" selected>中等</option>
          <option value="hard">困难</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ai-time">基本用时</label>
        <select id="ai-time">
          <option value="600000">10 分钟</option>
          <option value="900000">15 分钟</option>
          <option value="1200000">20 分钟</option>
          <option value="1800000" selected>30 分钟</option>
          <option value="2700000">45 分钟</option>
          <option value="3600000">1 小时</option>
          <option value="5400000">1.5 小时</option>
          <option value="7200000">2 小时</option>
          <option value="10800000">3 小时</option>
          <option value="18000000">5 小时</option>
        </select>
      </div>
      
      <div class="form-actions">
        <button id="btn-ai-back" class="btn-back">返回</button>
        <button id="btn-ai-start" class="btn-start btn-memorial">开始游戏</button>
      </div>
    </div>
  </div>

  <!-- WebRTC Setup Screen -->
  <div id="screen-webrtc" class="screen">
    <div class="setup-container glass-memorial">
      <h2>联机对战</h2>
      <div class="webrtc-options">
        <button id="btn-webrtc-host" class="menu-btn primary btn-memorial">
          <span class="btn-icon">🏠</span>
          <span class="btn-text">创建房间</span>
          <span class="btn-desc">Host Game</span>
        </button>
        
        <button id="btn-webrtc-join" class="menu-btn secondary btn-memorial-secondary">
          <span class="btn-icon">🔗</span>
          <span class="btn-text">加入房间</span>
          <span class="btn-desc">Join Game</span>
        </button>
      </div>
      
      <div class="form-actions">
        <button id="btn-webrtc-back" class="btn-back">返回</button>
      </div>
    </div>
  </div>

  <!-- WebRTC Host Setup Screen -->
  <div id="screen-webrtc-host" class="screen">
    <div class="setup-container glass-memorial">
      <h2>创建联机房间</h2>
      <div class="form-group">
        <label for="webrtc-host-name">玩家名称</label>
        <input type="text" id="webrtc-host-name" value="黑方" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="webrtc-host-time">基本用时</label>
        <select id="webrtc-host-time">
          <option value="600000">10 分钟</option>
          <option value="900000">15 分钟</option>
          <option value="1200000">20 分钟</option>
          <option value="1800000" selected>30 分钟</option>
          <option value="2700000">45 分钟</option>
          <option value="3600000">1 小时</option>
          <option value="5400000">1.5 小时</option>
          <option value="7200000">2 小时</option>
          <option value="10800000">3 小时</option>
          <option value="18000000">5 小时</option>
        </select>
      </div>
      <div class="form-group">
        <label for="webrtc-host-port">端口</label>
        <input type="number" id="webrtc-host-port" value="38765" min="1024" max="65535">
      </div>
      
      <div id="webrtc-host-waiting" class="waiting-info" style="display:none;">
        <div class="spinner"></div>
        <p>等待对手加入...</p>
        <p class="ip-info" id="webrtc-host-ip-info"></p>
      </div>
      
      <div class="form-actions">
        <button id="btn-webrtc-host-back" class="btn-back">返回</button>
        <button id="btn-webrtc-host-start" class="btn-start btn-memorial">开始等待</button>
      </div>
    </div>
  </div>

  <!-- WebRTC Join Game Screen -->
  <div id="screen-webrtc-join" class="screen">
    <div class="setup-container glass-memorial">
      <h2>加入联机房间</h2>
      <div class="form-group">
        <label for="webrtc-join-name">玩家名称</label>
        <input type="text" id="webrtc-join-name" value="白方" placeholder="输入名称">
      </div>
      
      <div class="form-group">
        <label>局域网房间</label>
        <div class="room-list-container">
          <div id="room-list" class="room-list">
            <div class="room-list-scanning">
              <div class="spinner"></div>
              <p>正在搜索局域网房间...</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="form-group room-manual-toggle">
        <a href="#" id="btn-webrtc-manual-toggle" class="manual-toggle-link">手动输入地址 ▼</a>
      </div>
      
      <div id="webrtc-manual-input" class="manual-input-section" style="display:none;">
        <div class="form-group">
          <label for="webrtc-join-host">主机地址</label>
          <input type="text" id="webrtc-join-host" placeholder="例如: 192.168.1.100">
        </div>
        <div class="form-group">
          <label for="webrtc-join-port">端口</label>
          <input type="number" id="webrtc-join-port" value="38765" min="1024" max="65535">
        </div>
        <div class="form-actions" style="margin-top: 0.5rem;">
          <button id="btn-webrtc-join-connect" class="btn-start btn-memorial" style="width:100%;">手动连接</button>
        </div>
      </div>
      
      <div id="webrtc-join-status" class="status-info" style="display:none;"></div>
      
      <div class="form-actions">
        <button id="btn-webrtc-join-back" class="btn-back">返回</button>
      </div>
    </div>
  </div>

  <!-- Game Screen -->
  <div id="screen-game" class="screen">
    <div class="game-layout">
      <!-- Left Panel - Player Info -->
      <div class="side-panel left-panel">
        <div class="player-card player-card-memorial" id="black-player-card">
          <div class="player-stone black-stone-icon"></div>
          <div class="player-info">
            <span class="player-name" id="black-player-name">黑方</span>
            <span class="player-captures" id="black-captures">提子: 0</span>
          </div>
          <div class="timer-display timer-memorial" id="black-timer">
            <span class="timer-main time-value" id="black-time-main">30:00</span>
            <span class="timer-byoyomi" id="black-byoyomi">读秒: 3×30s</span>
          </div>
        </div>
        
        <div class="player-card player-card-memorial" id="white-player-card">
          <div class="player-stone white-stone-icon"></div>
          <div class="player-info">
            <span class="player-name" id="white-player-name">白方</span>
            <span class="player-captures" id="white-captures">提子: 0</span>
          </div>
          <div class="timer-display timer-memorial" id="white-timer">
            <span class="timer-main time-value" id="white-time-main">30:00</span>
            <span class="timer-byoyomi" id="white-byoyomi">读秒: 3×30s</span>
          </div>
        </div>

        <div class="game-status" id="game-status">
          <p id="status-text">等待游戏开始...</p>
        </div>

        <div class="turn-info" id="turn-info">
          <span id="turn-number">第 0 手</span>
        </div>
      </div>

      <!-- Center - Board -->
      <div class="board-container board-background">
        <canvas id="game-board"></canvas>
      </div>

      <!-- Right Panel - Controls & History -->
      <div class="side-panel right-panel">
        <div class="game-controls">
          <button id="btn-pass" class="control-btn" disabled>
            <span>虚手 (Pass)</span>
          </button>
          <button id="btn-resign" class="control-btn danger" disabled>
            <span>认输 (Resign)</span>
          </button>
        </div>

        <div class="move-history-container">
          <h3>对局记录</h3>
          <div class="move-history" id="move-history"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Over Screen -->
  <div id="screen-result" class="screen">
    <div class="result-container glass-memorial">
      <h2 id="result-title">🏆 游戏结束 🏆</h2>
      <div class="result-scores">
        <div class="score-card black-score">
          <div class="score-stone black-stone-icon"></div>
          <span class="score-label">黑方</span>
          <span class="score-value" id="result-black-score">0</span>
          <span class="score-detail" id="result-black-detail"></span>
        </div>
        <div class="score-vs">VS</div>
        <div class="score-card white-score">
          <div class="score-stone white-stone-icon"></div>
          <span class="score-label">白方</span>
          <span class="score-value" id="result-white-score">0</span>
          <span class="score-detail" id="result-white-detail"></span>
        </div>
      </div>
      <p class="result-reason" id="result-reason"></p>
      <div class="result-actions">
        <button id="btn-result-home" class="menu-btn primary btn-memorial">返回主页</button>
      </div>
    </div>
  </div>

  <!-- Rules Modal -->
  <div id="modal-rules" class="modal" style="display:none;">
    <div class="modal-content glass-memorial">
      <h2>🏝️ 同弈规则 (SyncGo Rules)</h2>
      <div class="rules-content">
        <h3>基本规则</h3>
        <p>同弈是一种双方同时落子的围棋变体。每回合双方同时选择落子位置，然后同时揭晓。</p>
        <h3>碰撞规则</h3>
        <p>当双方落在同一位置时，产生"碰撞"，该位置出现红色标记棋子。红子不属于任何一方，但会占据该位置。</p>
        <h3>计时规则</h3>
        <p>采用日本式读秒规则。基本用时用完后进入读秒阶段（3次30秒读秒）。</p>
        <h3>胜负判定</h3>
        <p>双方虚手（Pass）后游戏结束，按中国规则计算胜负（贴7.5目）。</p>
      </div>
      <div class="modal-actions">
        <button id="btn-close-rules" class="btn-start btn-memorial">关闭</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/webrtc-client.js"></script>
  <script src="js/memorial-effects.js"></script>
  <script src="js/app.js"></script>
</body>
</html>