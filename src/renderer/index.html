<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self' ws: wss: stun: turn:">
  <title>同步围棋 - Simultaneous Go</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/board.css">
  <link rel="stylesheet" href="styles/ui.css">
</head>
<body>
  <!-- Home Screen -->
  <div id="screen-home" class="screen active">
    <div class="home-container">
      <h1 class="game-title">同步围棋</h1>
      <p class="game-subtitle">Simultaneous Go</p>
      
      <div class="menu-buttons">
        <button id="btn-host" class="menu-btn primary">
          <span class="btn-icon">🏠</span>
          <span class="btn-text">创建房间</span>
          <span class="btn-desc">Host Game</span>
        </button>
        
        <button id="btn-join" class="menu-btn secondary">
          <span class="btn-icon">🔗</span>
          <span class="btn-text">加入房间</span>
          <span class="btn-desc">Join Game</span>
        </button>
        
        <button id="btn-ai" class="menu-btn accent">
          <span class="btn-icon">🤖</span>
          <span class="btn-text">人机对弈</span>
          <span class="btn-desc">vs AI</span>
        </button>
        
        <button id="btn-webrtc" class="menu-btn accent">
          <span class="btn-icon">🌐</span>
          <span class="btn-text">P2P 对战</span>
          <span class="btn-desc">WebRTC</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Host Setup Screen -->
  <div id="screen-host" class="screen">
    <div class="setup-container">
      <h2>创建房间</h2>
      <div class="form-group">
        <label for="host-name">玩家名称</label>
        <input type="text" id="host-name" value="黑方" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="host-time">基本用时</label>
        <select id="host-time">
          <option value="600000">10 分钟</option>
          <option value="900000">15 分钟</option>
          <option value="1200000">20 分钟</option>
          <option value="1800000" selected>30 分钟</option>
          <option value="2700000">45 分钟</option>
          <option value="3600000">1 小时</option>
          <option value="5400000">1.5 小时</option>
          <option value="7200000">2 小时</option>
          <option value="10800000">3 小时</option>
          <option value="18000000">5 小时</option>
        </select>
      </div>
      <div class="form-group">
        <label for="host-port">端口</label>
        <input type="number" id="host-port" value="38765" min="1024" max="65535">
      </div>
      
      <div id="host-waiting" class="waiting-info" style="display:none;">
        <div class="spinner"></div>
        <p>等待对手加入...</p>
        <p class="ip-info" id="host-ip-info"></p>
      </div>
      
      <div class="form-actions">
        <button id="btn-host-back" class="btn-back">返回</button>
        <button id="btn-host-start" class="btn-start">开始等待</button>
      </div>
    </div>
  </div>

  <!-- Join Game Screen -->
  <div id="screen-join" class="screen">
    <div class="setup-container">
      <h2>加入房间</h2>
      <div class="form-group">
        <label for="join-name">玩家名称</label>
        <input type="text" id="join-name" value="白方" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="join-host">主机地址</label>
        <input type="text" id="join-host" placeholder="例如: 192.168.1.100">
      </div>
      <div class="form-group">
        <label for="join-port">端口</label>
        <input type="number" id="join-port" value="38765" min="1024" max="65535">
      </div>
      
      <div id="join-status" class="status-info" style="display:none;"></div>
      
      <div class="form-actions">
        <button id="btn-join-back" class="btn-back">返回</button>
        <button id="btn-join-connect" class="btn-start">连接</button>
      </div>
    </div>
  </div>

  <!-- AI Setup Screen -->
  <div id="screen-ai" class="screen">
    <div class="setup-container">
      <h2>人机对弈</h2>
      <div class="form-group">
        <label for="ai-name">玩家名称</label>
        <input type="text" id="ai-name" value="玩家" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="ai-color">选择颜色</label>
        <select id="ai-color">
          <option value="black">黑方 (先手)</option>
          <option value="white">白方</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ai-difficulty">AI 难度</label>
        <select id="ai-difficulty">
          <option value="easy">简单</option>
          <option value="medium" selected>中等</option>
          <option value="hard">困难</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ai-time">基本用时</label>
        <select id="ai-time">
          <option value="600000">10 分钟</option>
          <option value="900000">15 分钟</option>
          <option value="1200000">20 分钟</option>
          <option value="1800000" selected>30 分钟</option>
          <option value="2700000">45 分钟</option>
          <option value="3600000">1 小时</option>
          <option value="5400000">1.5 小时</option>
          <option value="7200000">2 小时</option>
          <option value="10800000">3 小时</option>
          <option value="18000000">5 小时</option>
        </select>
      </div>
      
      <div class="form-actions">
        <button id="btn-ai-back" class="btn-back">返回</button>
        <button id="btn-ai-start" class="btn-start">开始游戏</button>
      </div>
    </div>
  </div>

  <!-- WebRTC Setup Screen -->
  <div id="screen-webrtc" class="screen">
    <div class="setup-container">
      <h2>WebRTC 对战</h2>
      <div class="webrtc-options">
        <button id="btn-webrtc-host" class="menu-btn primary">
          <span class="btn-icon">🏠</span>
          <span class="btn-text">创建房间</span>
          <span class="btn-desc">Host Game</span>
        </button>
        
        <button id="btn-webrtc-join" class="menu-btn secondary">
          <span class="btn-icon">🔗</span>
          <span class="btn-text">加入房间</span>
          <span class="btn-desc">Join Game</span>
        </button>
      </div>
      
      <div class="form-actions">
        <button id="btn-webrtc-back" class="btn-back">返回</button>
      </div>
    </div>
  </div>

  <!-- WebRTC Host Setup Screen -->
  <div id="screen-webrtc-host" class="screen">
    <div class="setup-container">
      <h2>创建 P2P 房间</h2>
      <div class="form-group">
        <label for="webrtc-host-name">玩家名称</label>
        <input type="text" id="webrtc-host-name" value="黑方" placeholder="输入名称">
      </div>
      <div class="form-group">
        <label for="webrtc-host-time">基本用时</label>
        <select id="webrtc-host-time">
          <option value="600000">10 分钟</option>
          <option value="900000">15 分钟</option>
          <option value="1200000">20 分钟</option>
          <option value="1800000" selected>30 分钟</option>
          <option value="2700000">45 分钟</option>
          <option value="3600000">1 小时</option>
          <option value="5400000">1.5 小时</option>
          <option value="7200000">2 小时</option>
          <option value="10800000">3 小时</option>
          <option value="18000000">5 小时</option>
        </select>
      </div>
      <div class="form-group">
        <label for="webrtc-host-port">端口</label>
        <input type="number" id="webrtc-host-port" value="38765" min="1024" max="65535">
      </div>
      
      <div id="webrtc-host-waiting" class="waiting-info" style="display:none;">
        <div class="spinner"></div>
        <p>等待对手加入...</p>
        <p class="ip-info" id="webrtc-host-ip-info"></p>
      </div>
      
      <div class="form-actions">
        <button id="btn-webrtc-host-back" class="btn-back">返回</button>
        <button id="btn-webrtc-host-start" class="btn-start">开始等待</button>
      </div>
    </div>
  </div>

  <!-- WebRTC Join Game Screen -->
  <div id="screen-webrtc-join" class="screen">
    <div class="setup-container">
      <h2>加入 P2P 房间</h2>
      <div class="form-group">
        <label for="webrtc-join-name">玩家名称</label>
        <input type="text" id="webrtc-join-name" value="白方" placeholder="输入名称">
      </div>
      
      <div class="form-group">
        <label>局域网房间</label>
        <div class="room-list-container">
          <div id="room-list" class="room-list">
            <div class="room-list-scanning">
              <div class="spinner"></div>
              <p>正在搜索局域网房间...</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="form-group room-manual-toggle">
        <a href="#" id="btn-webrtc-manual-toggle" class="manual-toggle-link">手动输入地址 ▼</a>
      </div>
      
      <div id="webrtc-manual-input" class="manual-input-section" style="display:none;">
        <div class="form-group">
          <label for="webrtc-join-host">主机地址</label>
          <input type="text" id="webrtc-join-host" placeholder="例如: 192.168.1.100">
        </div>
        <div class="form-group">
          <label for="webrtc-join-port">端口</label>
          <input type="number" id="webrtc-join-port" value="38765" min="1024" max="65535">
        </div>
        <div class="form-actions" style="margin-top: 0.5rem;">
          <button id="btn-webrtc-join-connect" class="btn-start" style="width:100%;">手动连接</button>
        </div>
      </div>
      
      <div id="webrtc-join-status" class="status-info" style="display:none;"></div>
      
      <div class="form-actions">
        <button id="btn-webrtc-join-back" class="btn-back">返回</button>
      </div>
    </div>
  </div>

  <!-- Game Screen -->
  <div id="screen-game" class="screen">
    <div class="game-layout">
      <!-- Left Panel - Player Info -->
      <div class="side-panel left-panel">
        <div class="player-card" id="black-player-card">
          <div class="player-stone black-stone-icon"></div>
          <div class="player-info">
            <span class="player-name" id="black-player-name">黑方</span>
            <span class="player-captures" id="black-captures">提子: 0</span>
          </div>
          <div class="timer-display" id="black-timer">
            <span class="timer-main" id="black-time-main">30:00</span>
            <span class="timer-byoyomi" id="black-byoyomi">读秒: 3×30s</span>
          </div>
        </div>
        
        <div class="player-card" id="white-player-card">
          <div class="player-stone white-stone-icon"></div>
          <div class="player-info">
            <span class="player-name" id="white-player-name">白方</span>
            <span class="player-captures" id="white-captures">提子: 0</span>
          </div>
          <div class="timer-display" id="white-timer">
            <span class="timer-main" id="white-time-main">30:00</span>
            <span class="timer-byoyomi" id="white-byoyomi">读秒: 3×30s</span>
          </div>
        </div>

        <div class="game-status" id="game-status">
          <p id="status-text">等待游戏开始...</p>
        </div>

        <div class="turn-info" id="turn-info">
          <span id="turn-number">第 0 手</span>
        </div>
      </div>

      <!-- Center - Board -->
      <div class="board-container">
        <canvas id="game-board"></canvas>
      </div>

      <!-- Right Panel - Controls & History -->
      <div class="side-panel right-panel">
        <div class="game-controls">
          <button id="btn-pass" class="control-btn" disabled>
            <span>虚手 (Pass)</span>
          </button>
          <button id="btn-resign" class="control-btn danger" disabled>
            <span>认输 (Resign)</span>
          </button>
        </div>

        <div class="move-history-container">
          <h3>对局记录</h3>
          <div class="move-history" id="move-history"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Over Screen -->
  <div id="screen-result" class="screen">
    <div class="result-container">
      <h2 id="result-title">游戏结束</h2>
      <div class="result-scores">
        <div class="score-card black-score">
          <div class="score-stone black-stone-icon"></div>
          <span class="score-label">黑方</span>
          <span class="score-value" id="result-black-score">0</span>
          <span class="score-detail" id="result-black-detail"></span>
        </div>
        <div class="score-vs">VS</div>
        <div class="score-card white-score">
          <div class="score-stone white-stone-icon"></div>
          <span class="score-label">白方</span>
          <span class="score-value" id="result-white-score">0</span>
          <span class="score-detail" id="result-white-detail"></span>
        </div>
      </div>
      <p class="result-reason" id="result-reason"></p>
      <div class="result-actions">
        <button id="btn-result-home" class="menu-btn primary">返回主页</button>
      </div>
    </div>
  </div>

  <!-- Rules Modal -->
  <div id="modal-rules" class="modal" style="display:none;">
    <div class="modal-content">
      <h2>同步围棋规则</h2>
      <div class="rules-text">
        <h3>基本规则</h3>
        <p>同步围棋是围棋的变体，双方在每一步中<strong>同时下棋</strong>。</p>
        
        <h3>落子规则</h3>
        <ul>
          <li>每一步中，黑白双方各自选择一个位置落子（或虚手）</li>
          <li>双方都提交后，才在棋盘上显示双方的棋子</li>
          <li>如果双方下在同一个位置，该位置变为<strong style="color:#ff4444;">红色棋子</strong></li>
        </ul>
        
        <h3>红色棋子</h3>
        <ul>
          <li>红棋一旦出现，永久固定不动</li>
          <li>红棋不能被吃掉</li>
          <li>红棋会减少相邻棋组的气</li>
          <li>红棋不算任何一方的棋子</li>
        </ul>
        
        <h3>提子规则</h3>
        <ul>
          <li>双方落子后，同时检查所有棋组的气</li>
          <li>所有没有气的棋组同时被提掉</li>
          <li>如果双方棋组同时没气（双杀），两组都提掉</li>
        </ul>
        
        <h3>计时规则</h3>
        <ul>
          <li>每步给双方各自基本用时，可自由分配</li>
          <li>基本用时用完后，每步30秒内必须落子</li>
          <li>超时消耗一次读秒（共3次），重新计时30秒</li>
          <li>三次读秒用完后不能再落子</li>
        </ul>
        
        <h3>胜负判定</h3>
        <ul>
          <li>双方都虚手时游戏结束</li>
          <li>使用中国规则（数子法）计算胜负</li>
          <li>棋子数 + 围住的空 = 得分</li>
          <li>红棋不算任何一方的分数</li>
        </ul>
      </div>
      <button id="btn-close-rules" class="btn-start">关闭</button>
    </div>
  </div>

  <script src="js/webrtc-client.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
